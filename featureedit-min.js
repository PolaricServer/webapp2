(()=>{var pol;(()=>{const e=ol.interaction.Draw,o=ol.interaction.Modify,t=ol.interaction.Snap,r=ol.interaction.Select,l=ol.interaction.getActive,n=ol.layer.Vector,a=ol.source.Vector,i=ol.style.Circle,c=ol.style.Fill,s=ol.style.Stroke,d=ol.style.Style,m=ol.style.Icon,g=ol.proj.fromLonLat,u=ol.sphere,p=ol.geom.Polygon,w=ol.geom.Point,k=ol.Feature;ol.format.GeoJSON,ol.format.GPX;var snow=window.snow||{};if(window.snow=snow,window.snow.Draw=e,window.snow.Modify=o,window.snow.Snap=t,window.snow.DrawSelect=r,window.snow.getActive=l,window.snow.VectorLayer=n,window.snow.VectorSource=a,window.snow.CircleStyle=i,window.snow.Fill=c,window.snow.Stroke=s,window.snow.Style=d,window.snow.Icon=m,window.snow.FromLonLat=g,window.snow.Sphere=u,window.snow.PolygonGeom=p,window.snow.Point=w,window.snow.Feature=k,snow.color=[{fill:"#1f1f1f",stroke:null},{fill:"#e60505",stroke:"#d00505"},{fill:"#ff9a28",stroke:"#d07000"},{fill:"#ffff00",stroke:"#a06000"},{fill:"#01b301",stroke:"#01a001"},{fill:"#05a0d0",stroke:"#0285c0"},{fill:"#a300a3",stroke:null}],snow.activateFreedraw="N",snow.draw=null,snow.snap=!1,snow.drawSelect=!1,snow.feature=!1,snow.drawSelect=!1,snow.toggleDraw=!1,snow.toggleModify=!1,snow.toggleSnap=!1,snow.toggleFreeHand=!1,snow.toggleTooltip=!1,snow.droppingIcon=!1,snow.toggleAreal=!1,snow.drodownShown=!1,snow.continuousIconDropping=!1,snow.currentStyle=null,snow.originalStyles=[],snow.selectedFeatures=[],snow.lastSelected=null,snow.drawType="Polygon",snow.testHex=function(e){return!(!e||null==e)&&0==e.fill.search(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)},snow.hexOpacity="20",snow.hexColor=[{fill:"#1f1f1f",stroke:null},{fill:"#e60000",stroke:null},{fill:"#ff9a28",stroke:null},{fill:"#ffff00",stroke:null},{fill:"#01b301",stroke:null},{fill:"#33ccff",stroke:null},{fill:"#a300a3",stroke:null}],snow.color)for(let e=0;e<7;e++)snow.testHex(snow.color[e])&&(snow.hexColor[e]=snow.color[e]);snow.hexSelectStroke="#0569ff",snow.hexSelectFill="#9ebbff",snow.cssColors=()=>{$("#selectBlack").css("background-color",snow.hexColor[0].fill),$("#selectRed").css("background-color",snow.hexColor[1].fill),$("#selectOrange").css("background-color",snow.hexColor[2].fill),$("#selectYellow").css("background-color",snow.hexColor[3].fill),$("#selectGreen").css("background-color",snow.hexColor[4].fill),$("#selectBlue").css("background-color",snow.hexColor[5].fill),$("#selectPurple").css("background-color",snow.hexColor[6].fill)},snow.drawSource=new a,snow.drawLayer=snow.draftLayer=new n({name:"DRAFT",source:snow.drawSource}),snow.drawMap=null,snow.changeLayer=function(e){const o=snow.drawLayer;return snow.drawSource=e.getSource(),snow.drawLayer=e,o},snow.init=function(e){snow.drawMap=e,snow.drawMap.addLayer(snow.drawLayer),snow.activateFreedraw.toUpperCase(),"Y"==snow.activateFreedraw||"YES"==snow.activateFreedraw||"JA"==snow.activateFreedraw?snow.toggleFreehand=!0:snow.toggleFreehand=!1},snow.handleClick=function(e){snow.manualSelect(e.pixel)},snow.activate=function(){snow.drawMap.on("click",snow.handleClick),setTimeout(()=>{$("#filledstyle").addClass("selectedFunction"),$("#straight").addClass("selectedFunction")},500)},snow.deactivate=function(){snow.drawMap.un("click",snow.handleClick)},window.snow=snow})(),(()=>{var snow=window.snow;snow.undoArr=null,snow.undoCount=0,snow.undoMaxCount=20,snow.initUndo=function(){null===snow.undoArr&&snow.drawSource&&(snow.undoArr=[snow.drawSource.getFeatures()])},snow.addNewChange=function(e){snow.initUndo(),snow.undoArr.length>=snow.undoMaxCount&&snow.undoArr.shift();let o=snow.drawSource.getFeatures();e&&(o=o.concat(e)),snow.undoArr.push(o),snow.undoCount=snow.undoArr.length-1},snow.undoChange=function(){snow.initUndo(),snow.undoCount>0?(snow.undoCount--,console.log(snow.undoCount)):snow.undoCount=0,snow.drawSource.clear(),snow.drawSource.addFeatures(snow.undoArr[snow.undoCount])},snow.redoChange=function(){snow.initUndo(),snow.undoCount<snow.undoMaxCount-1&&snow.undoCount+1<snow.undoArr.length&&snow.undoCount++,snow.undoCount<snow.undoArr.length&&(snow.drawSource.clear(),snow.drawSource.addFeatures(snow.undoArr[snow.undoCount]))},snow.redoChange_click=function(){snow.redoChange()},snow.undoChange_click=function(){snow.undoChange()}})(),(()=>{var snow=window.snow;snow.setStyleColor=function(e){let o=snow.currentStyle;o=null==o?snow.getStyle(e.fill):o.clone(),o.getStroke().setColor(e.fill),null!=e.stroke&&o.getStroke().setColor(e.stroke),o.getFill()&&o.getFill().setColor(e.fill+snow.hexOpacity),o.getText().getFill().setColor(e.fill),snow.currentStyle=o},snow.setStyleDashed=function(e){let o=snow.currentStyle;o=null==o?snow.getStyle(hexBlack):o.clone(),o.getStroke().setLineDash(e?[3.5,4]:[0,0]),snow.currentStyle=o},snow.setStyleThin=function(e){let o=snow.currentStyle;o=null==o?snow.getStyle(hexBlack):o.clone(),o.getStroke().setWidth(e?1.1:2.1),snow.currentStyle=o},snow.setStyleFilled=function(e){let o=snow.currentStyle;o=null==o?snow.getStyle(hexBlack):o.clone(),o.setFill(e?new ol.style.Fill({color:o.getStroke().getColor()+snow.hexOpacity}):null),snow.currentStyle=o},snow.getStyle=function(e){return new ol.style.Style({stroke:new ol.style.Stroke({color:e,width:2.1}),fill:new snow.Fill({color:e+snow.hexOpacity}),text:new ol.style.Text({fill:new ol.style.Fill({color:e}),stroke:new ol.style.Stroke({width:2.5,color:"#fff"}),scale:1})})},snow.hexColor&&snow.hexColor[0]&&snow.setStyleColor(snow.hexColor[0]),snow.selectStyle=new ol.style.Style({stroke:new ol.style.Stroke({color:snow.hexSelectStroke,width:"3.5",lineDash:[4,5]}),fill:new ol.style.Fill({color:snow.hexSelectFill+snow.hexOpacity})}),snow.deleteHighlightHandler=function(){$("#deleteLayer").mousedown(()=>{$("#deleteLayer").addClass("selectedFunction")}).mouseup(()=>{$("#deleteLayer").removeClass("selectedFunction")}).mouseleave(()=>{$("#deleteLayer").removeClass("selectedFunction")})}})(),(()=>{var snow=window.snow;snow.drawCB=[],snow.addDrawCB=function(e){snow.drawCB.push(e)},snow.addDraw=function(){for(f of(snow.draw=new window.snow.Draw({source:snow.drawSource,type:snow.drawType,freehand:snow.toggleFreehand}),snow.drawMap.addInteraction(snow.draw),$("#drawToggle").addClass("selectedFunction"),snow.draw.on("drawend",e=>{e.feature.setStyle(snow.currentStyle.clone()),snow.addNewChange(e.feature)}),snow.drawCB))snow.draw.on("drawend",f)},snow.addModify=function(){snow.modify=new snow.Modify({source:snow.drawSource}),snow.drawMap.addInteraction(snow.modify),$("#modifyToggle").addClass("selectedFunction")},snow.addSnap=function(){snow.snap=new snow.Snap({source:snow.drawSource}),snow.drawMap.addInteraction(snow.snap),$("#snapToggle").addClass("selectedFunction")},snow.removeDraw=function(){snow.drawMap.removeInteraction(snow.draw),$("#drawToggle").removeClass("selectedFunction")},snow.removeModify=function(){snow.drawMap.removeInteraction(snow.modify),$("#modifyToggle").removeClass("selectedFunction")},snow.removeSnap=function(){snow.drawMap.removeInteraction(snow.snap),$("#snapToggle").removeClass("selectedFunction")},snow.refreshDraw=function(){snow.toggleDraw&&(snow.removeDraw(),snow.addDraw())}})(),(()=>{var snow=window.snow;$(function(){$(document).tooltip()}),snow.tooltip_click=function(){snow.toggleTooltip?($("#tooltip").removeClass("selectedFunction"),$("#straight").removeAttr("title"),$("#freehand").removeAttr("title"),$("#type").removeAttr("title"),$("#optLine").removeAttr("title"),$("#optPolygon").removeAttr("title"),$("#optCircle").removeAttr("title"),$("#selectBlack").removeAttr("title"),$("#selectRed").removeAttr("title"),$("#selectOrange").removeAttr("title"),$("#selectYellow").removeAttr("title"),$("#selectGreen").removeAttr("title"),$("#selectBlue").removeAttr("title"),$("#selectPurple").removeAttr("title"),$("#drawToggle").removeAttr("title"),$("#deleteLayer").removeAttr("title"),$("#modifyToggle").removeAttr("title"),$("#snapToggle").removeAttr("title")):($("#tooltip").addClass("selectedFunction"),$("#straight").attr("title","Enables drawing with a point to point type line"),$("#freehand").attr("title","Enables freehand drawing. Note: freehand is hard to modify on later"),$("#type").attr("title","Selects Geometry type"),$("#optLine").attr("title","Draws a line, useful for making paths"),$("#optPolygon").attr("title","Draws a polygon, useful for marking areas"),$("#optCircle").attr("title","Draws a circle on map, useful for encapsulating an area"),$("#selectBlack").attr("title","Sets the marking color as Black and changes color of selected areas."),$("#selectRed").attr("title","Sets the marking color as Red and changes color of selected areas."),$("#selectOrange").attr("title","Sets the marking color as Orange and changes color of selected areas."),$("#selectYellow").attr("title","Sets the marking color as Yellow and changes color of selected areas."),$("#selectGreen").attr("title","Sets the marking color as Green and changes color of selected areas."),$("#selectBlue").attr("title","Sets the marking color as Blue and changes color of selected areas."),$("#selectPurple").attr("title","Sets the marking color as Purpleg and changes color of selected areas."),$("#drawToggle").attr("title","Enables drawing"),$("#deleteLayer").attr("title","Deletes the selected feature from the map"),$("#modifyToggle").attr("title","Toggles modify on/off for drawn areas"),$("#snapToggle").attr("title","Toggles snap on/off while drawing")),snow.toggleTooltip=!snow.toggleTooltip}})(),(()=>{var snow=window.snow;snow.drawToggle_click=function(){snow.toggleDraw?(snow.removeSnap(),snow.removeDraw()):(snow.addDraw(),snow.toggleSnap&&snow.addSnap(),snow.toggleModify&&(snow.removeModify(),snow.toggleModify=!1)),snow.toggleDraw=!snow.toggleDraw},snow.modifyToggle_click=function(){snow.removeDraw(),snow.removeSnap(),snow.toggleDraw=!1,snow.toggleModify?snow.removeModify():snow.addModify(),snow.toggleModify=!snow.toggleModify},snow.snapToggle_click=function(){(snow.toggleDraw||snow.toggleModify)&&(snow.toggleSnap?snow.removeSnap():snow.addSnap(),snow.toggleSnap=!snow.toggleSnap)},snow.deleteLayer_click=function(){try{snow.selectedFeatures[0]&&(snow.selectedFeatures.forEach(e=>{e.remove=!0,snow.drawSource.removeFeature(e),snow.removeSingleMeasureTooltip(e)}),snow.selectedFeatures=[],snow.addNewChange())}catch(e){console.log("Unexpected Error Caught:\n"+e)}},snow.deleteFeature=function(e){e.remove=!0,snow.drawSource.removeFeature(e)},snow.drawingColor="selectBlack",snow.colorOption_click=function(e){switch($("#"+snow.drawingColor).removeClass("selectedColor"),snow.drawingColor=e.target.id,$("#"+snow.drawingColor).addClass("selectedColor"),snow.drawingColor){case"selectRed":snow.setStyleColor(snow.hexColor[1]);break;case"selectOrange":snow.setStyleColor(snow.hexColor[2]);break;case"selectYellow":snow.setStyleColor(snow.hexColor[3]);break;case"selectGreen":snow.setStyleColor(snow.hexColor[4]);break;case"selectBlue":snow.setStyleColor(snow.hexColor[5]);break;case"selectPurple":snow.setStyleColor(snow.hexColor[6]);break;default:snow.setStyleColor(snow.hexColor[0])}snow.updateStyle()},snow.updateStyle=function(){snow.selectedFeatures[0]&&(snow.selectedFeatures.forEach(e=>{e.chStyle=!0,e.setStyle(snow.currentStyle),e.originalStyle=NaN}),snow.selectedFeatures=[])},snow.tooltipElement=null,snow.toggleMetric_click=function(){snow.toggleAreal?($("#printMetric").removeClass("selectedFunction"),snow.removeAllMeasureTooltip()):($("#printMetric").addClass("selectedFunction"),snow.addMeasureOverlay()),snow.toggleAreal=!snow.toggleAreal},snow.getAreal=function(e){let o="none selected";const t=e.getGeometry(),r=t.getType();if("Polygon"==r){o=l("1",Sphere.getArea(t))}else if("Circle"==r){o="a = "+l("1",Sphere.getArea(PolygonGeom.fromCircle(t)))+"<br> r = "+l("2",t.getRadius())}else if("LineString"==r){o=l("2",Sphere.getLength(t))}return o;function l(e,o){let t;return"1"==e?(t=o>1e4?Math.round(o/1e6*100)/100+" km<sup>2</sup>":Math.round(100*o)/100+" m<sup>2</sup>",t):"2"==e?(t=o>100?Math.round(o/1e3*100)/100+" km":Math.round(100*o)/100+" m",t):void 0}},snow.freehand_click=function(){0==snow.toggleFreehand&&(snow.toggleFreehand=!0,$("#freehand").addClass("selectedFunction"),$("#straight").removeClass("selectedFunction"),snow.refreshDraw())},snow.straight_click=function(){1==snow.toggleFreehand&&(snow.toggleFreehand=!1,$("#straight").addClass("selectedFunction"),$("#freehand").removeClass("selectedFunction"),snow.refreshDraw())},snow.thinstyle=!1,snow.dashedstyle=!1,snow.filledstyle=!0,snow.thinstyle_click=function(){1==snow.thinstyle?(snow.thinstyle=!1,$("#thinstyle").removeClass("selectedFunction")):(snow.thinstyle=!0,$("#thinstyle").addClass("selectedFunction")),snow.setStyleThin(snow.thinstyle),snow.updateStyle(),snow.refreshDraw()},snow.dashedstyle_click=function(){1==snow.dashedstyle?(snow.dashedstyle=!1,$("#dashedstyle").removeClass("selectedFunction")):(snow.dashedstyle=!0,$("#dashedstyle").addClass("selectedFunction")),snow.setStyleDashed(snow.dashedstyle),snow.updateStyle(),snow.refreshDraw()},snow.filledstyle_click=function(){1==snow.filledstyle?(snow.filledstyle=!1,$("#filledstyle").removeClass("selectedFunction")):(snow.filledstyle=!0,$("#filledstyle").addClass("selectedFunction")),snow.setStyleFilled(snow.filledstyle),snow.updateStyle(),snow.refreshDraw()},snow.featureCheck=!1,snow.manualSelect=function(e){snow.toggleDraw||(snow.featureCheck=!1,snow.drawMap.forEachFeatureAtPixel(e,function(e){let o=e.getGeometry().getType();"Point"!=o||snow.toggleDraw?"Circle"!=o&&"Polygon"!=o&&"LineString"!=o||snow.selectMarkedArea(e):snow.selectIcons(e)}),snow.featureCheck||snow.deselectAll())},snow.deselectAll=function(){snow.selectedFeatures.forEach(e=>{e.setStyle(e.originalStyle),e.originalStyle=NaN}),snow.toggleAreal&&snow.removeAllMeasureTooltip(),snow.selectedFeatures=[]},snow.selectMarkedArea=function(e){if(snow.drawSource.getFeatures().includes(e)&&!snow.selectedFeatures.includes(e))e.originalStyle=e.getStyle(),e.setStyle(snow.selectStyle),snow.selectedFeatures.push(e),snow.lastSelected=e,snow.toggleAreal&&snow.addMeasureOverlay(e),$(document).trigger("selectfeature");else if(snow.selectedFeatures.includes(e)){e.setStyle(e.originalStyle),e.originalStyle=NaN;let o=snow.selectedFeatures.indexOf(e);snow.selectedFeatures.splice(o,1),snow.toggleAreal&&snow.removeSingleMeasureTooltip(e)}snow.featureCheck||(snow.featureCheck=!0)},snow.selectIcons=function(e){snow.droppingIcon?snow.droppingIcon=!1:(snow.lastSelected=e,$(document).trigger("selectfeature"))},snow.setCurrentType=function(e){"optPolygon"==e?snow.drawType="Polygon":"optLine"==e?snow.drawType="LineString":"optCircle"==e?snow.drawType="Circle":console.log("Unexpected error while selecting geometry type"),snow.refreshDraw()}})(),(()=>{var snow=window.snow;snow.download=function(e,o){var t=document.createElement("a");t.setAttribute("href","data:text/gpx;charset=utf-8,"+encodeURIComponent(o)),t.setAttribute("download",e),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)},snow.gpxFromFeature=function(){if(selectedFeatures[0]){return gpxFormat.writeFeatures(selectedFeatures)}},snow.downloadGpx_click=function(){let e=gpxFromFeature();download("gpxDownload.gpx",e)}})(),(()=>{var snow=window.snow;snow.imageLoc="images/iconpack/",snow.iconStyle=null,snow.thisID=null,snow.getIconStyle=function(e){return new ol.style.Icon({anchor:[.5,38],anchorXUnits:"fraction",anchorYUnits:"pixels",src:e})},snow.markerIcons_click=function(e){if(snow.drawMap.removeInteraction(snow.draw),$("#"+snow.thisID).removeClass("selectedIcon"),console.log("snow.thisID",snow.thisID,"e.target.id",e.target.id),snow.thisID==e.target.id)return snow.thisID=null,null;snow.thisID=e.target.id,$("#"+snow.thisID).addClass("selectedIcon");let o=$("#"+snow.thisID).attr("src"),t=snow.thisID.split("-",2)[1],r=new ol.style.Style({image:snow.getIconStyle(o)});for(f of(snow.draw=new ol.interaction.Draw({source:snow.drawSource,type:"Point",name:"POINT"}),snow.drawMap.addInteraction(snow.draw),droppingIcon=!0,snow.draw.on("drawend",function(e){e.feature.setStyle(r),e.feature.label=t,snow.addNewChange(e.feature),snow.continuousIconDropping||(snow.drawMap.removeInteraction(snow.draw),$("#"+snow.thisID).removeClass("selectedIcon"),snow.thisID=null)}),snow.drawCB))snow.draw.on("drawend",f)}})(),(()=>{var snow=window.snow;drawPopup={view:function(){return m("div",[m("div",{class:"drawTab"},[m("p",{id:"drawTab",class:"selectedTab",title:"Tab for showing marking functions",onclick:showDrawbox_click},"Draw"),m("p",{id:"iconTab",title:"Tab for placing icons on the map",onclick:showIconbox_click},"Icon")]),m("h1",{id:"drawPopupTitle",class:"ui-draggable-handle"},"Draw Tools"),m("div",{id:"drawBox"}),m("div",{id:"iconBox"})])}},window.snow.drawPopup=drawPopup,drawTools={view:function(){return m("div",{id:"drawtools"},[m("img",{src:"images/drawIcons/questionmark_48px.png",id:"tooltip",title:"Tooltip Helper, click and mouseover other functions",onclick:snow.tooltip_click}),m("div",[m("div",[m("div.igroup",[m("label",{class:"non-interactive"},["Draw type: ",m.trust("&nbsp;")]),m("div",[m("img",{src:"images/drawIcons/straightline_50px.png",id:"straight",class:"drawIcon",onclick:snow.straight_click}),m("img",{src:"images/drawIcons/wigglyline_50px.png",id:"freehand",class:"drawIcon",onclick:snow.freehand_click})])]),m("div.igroup",[m("label",{class:"non-interactive"},["Style: ",m.trust("&nbsp;")]),m("div",[m("img",{src:"images/drawIcons/line_thin.png",id:"thinstyle",class:"drawIcon",onclick:snow.thinstyle_click}),m("img",{src:"images/drawIcons/line_dashed.png",id:"dashedstyle",class:"drawIcon",onclick:snow.dashedstyle_click}),m("img",{src:"images/drawIcons/polygon_filled.png",id:"filledstyle",class:"drawIcon",onclick:snow.filledstyle_click})])])]),m("label",{class:"non-interactive"},["Color Selector: ",m.trust("&nbsp;")]),m("div",{id:"ColorSelecter"},[m("span",{class:"colorOption selectedColor",id:"selectBlack",onclick:snow.colorOption_click}),m("span",{class:"colorOption",id:"selectRed",onclick:snow.colorOption_click}),m("span",{class:"colorOption",id:"selectOrange",onclick:snow.colorOption_click}),m("span",{class:"colorOption",id:"selectYellow",onclick:snow.colorOption_click}),m("span",{class:"colorOption",id:"selectGreen",onclick:snow.colorOption_click}),m("span",{class:"colorOption",id:"selectBlue",onclick:snow.colorOption_click}),m("span",{class:"colorOption",id:"selectPurple",onclick:snow.colorOption_click})]),m("label",{class:"non-interactive"},["Functions: ",m.trust("&nbsp;")]),m("div",[m("img",{src:"images/drawIcons/draw_128px.png",id:"drawToggle",class:"drawIcon",onclick:()=>snow.drawToggle_click()}),m("img",{src:"images/drawIcons/edit_50px.png",id:"modifyToggle",class:"drawIcon",onclick:snow.modifyToggle_click}),m("img",{src:"images/drawIcons/trashCan_50px.png",id:"deleteLayer",class:"drawIcon",onclick:snow.deleteLayer_click}),m("img",{src:"images/drawIcons/snap_50px.png",id:"snapToggle",class:"drawIcon",onclick:snow.snapToggle_click}),m("img",{src:"images/drawIcons/km2_50px.png",id:"printMetric",class:"drawIcon",onclick:snow.toggleMetric_click})])])])}},window.snow.drawTools=drawTools})(),(()=>{var snow=window.snow;snow.iconTools={view:function(){return m("div",{id:"icontools"},[m("div",{id:"iconContainer"},[m("img",{src:"images/iconpack/1.Bunker.png",class:"drawIcons",id:"markerIcon-Bunker",title:"Bunker",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/1.Factory.png",class:"drawIcons",id:"markerIcon-Factory",title:"Factory",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/1.Oil-rig2.png",class:"drawIcons",id:"markerIcon-Oil-rig2",title:"Oil-rig2",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/1.Radio-station.png",class:"drawIcons",id:"markerIcon-Radio-station",title:"Radio-station",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/1.Warehouse-2.png",class:"drawIcons",id:"markerIcon-Warehouse-2",title:"Warehouse-2",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/1.Wind-turbine.png",class:"drawIcons",id:"markerIcon-Wind-turbine",title:"Wind-turbine",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.Ambulance-boat.png",class:"drawIcons",id:"markerIcon-Ambulance-boat",title:"Ambulance-boat",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.First-taid.png",class:"drawIcons",id:"markerIcon-First-taid",title:"First-taid",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.Footprint.png",class:"drawIcons",id:"markerIcon-Footprint",title:"Footprint",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.Hospital-building.png",class:"drawIcons",id:"markerIcon-Hospital-building",title:"Hospital-building",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.Medicine.png",class:"drawIcons",id:"markerIcon-Medicine",title:"Medicine",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.Nursing-home.png",class:"drawIcons",id:"markerIcon-Nursing-home",title:"Nursing-home",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.School-or-university.png",class:"drawIcons",id:"markerIcon-School-or-university",title:"School-or-university",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.Summer-camp.png",class:"drawIcons",id:"markerIcon-Summer-camp",title:"Summer-camp",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/2.Toilets.png",class:"drawIcons",id:"markerIcon-Toilets",title:"Toilets",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Aircraft-small.png",class:"drawIcons",id:"markerIcon-Aircraft-small",title:"Aircraft-small",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Airport.png",class:"drawIcons",id:"markerIcon-Airport",title:"Airport",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Ambulance.png",class:"drawIcons",id:"markerIcon-Ambulance",title:"Ambulance",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Barrier.png",class:"drawIcons",id:"markerIcon-Barrier",title:"Barrier",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Bus.png",class:"drawIcons",id:"markerIcon-Bus",title:"Bus",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Car-fourbyfour.png",class:"drawIcons",id:"markerIcon-Car-fourbyfour",title:"Car-fourbyfour",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Car.png",class:"drawIcons",id:"markerIcon-Car",title:"Car",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Caution.png",class:"drawIcons",id:"markerIcon-Caution",title:"Caution",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Disability.png",class:"drawIcons",id:"markerIcon-Disability",title:"Disability",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Ferry.png",class:"drawIcons",id:"markerIcon-Ferry",title:"Ferry",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Fuel-fillingstation.png",class:"drawIcons",id:"markerIcon-Fuel-fillingstation",title:"Fuel-fillingstation",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Harbor.png",class:"drawIcons",id:"markerIcon-Harbor",title:"Harbor",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Helicopter.png",class:"drawIcons",id:"markerIcon-Helicopter",title:"Helicopter",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Parking.png",class:"drawIcons",id:"markerIcon-Parking",title:"Parking",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Railway.png",class:"drawIcons",id:"markerIcon-Railway",title:"Railway",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/3.Repair.png",class:"drawIcons",id:"markerIcon-Repair",title:"Repair",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Avalanche.png",class:"drawIcons",id:"markerIcon-Avalanche",title:"Avalanche",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Danger.png",class:"drawIcons",id:"markerIcon-Danger",title:"Danger",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Earthquake-3.png",class:"drawIcons",id:"markerIcon-Earthquake-3",title:"Earthquake-3",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Explosion-or-explosive.png",class:"drawIcons",id:"markerIcon-Explosion-or-explosive",title:"Explosion-or-explosive",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Fire.png",class:"drawIcons",id:"markerIcon-Fire",title:"Fire",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Flood.png",class:"drawIcons",id:"markerIcon-Flood",title:"Flood",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Person-down.png",class:"drawIcons",id:"markerIcon-Person-down",title:"Person-down",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Plane-accident.png",class:"drawIcons",id:"markerIcon-Plane-accident",title:"Plane-accident",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Radiation.png",class:"drawIcons",id:"markerIcon-Radiation",title:"Radiation",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Rescue.png",class:"drawIcons",id:"markerIcon-Rescue",title:"Rescue",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/4.Shooting.png",class:"drawIcons",id:"markerIcon-Shooting",title:"Shooting",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/5.Coffee.png",class:"drawIcons",id:"markerIcon-Coffee",title:"Coffee",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/5.Food.png",class:"drawIcons",id:"markerIcon-Food",title:"Food",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/5.Lodging.png",class:"drawIcons",id:"markerIcon-Lodging",title:"Lodging",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/5.Wi-Fi.png",class:"drawIcons",id:"markerIcon-Wi-Fi",title:"Wi-Fi",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/6.Number-1.png",class:"drawIcons",id:"markerIcon-Number-1",title:"Number-1",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/6.Number-2.png",class:"drawIcons",id:"markerIcon-Number-2",title:"Number-2",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/6.Number-3.png",class:"drawIcons",id:"markerIcon-Number-3",title:"Number-3",onclick:e=>{snow.markerIcons_click(e)}}),m("img",{src:"images/iconpack/6.Number-4.png",class:"drawIcons",id:"markerIcon-Number-4",title:"Number-4",onclick:e=>{snow.markerIcons_click(e)}})])])}}})(),(()=>{var snow=window.snow;snow.measureTooltipElement=null,snow.measureTooltip=null,addMeasureOverlay=function(e=null){let o;function t(e){snow.createMeasureTooltip(e),e.getGeometry()instanceof PolygonGeom?o=e.getGeometry().getInteriorPoint().getCoordinates():e.getGeometry()instanceof ol.geom.LineString?o=e.getGeometry().getLastCoordinate():e.getGeometry()instanceof ol.geom.Circle&&(o=e.getGeometry().getCenter()),snow.measureTooltipElement.innerHTML=snow.getAreal(e),snow.measureTooltip.setPosition(o)}e?t(e):snow.selectedFeatures[0]&&snow.selectedFeatures.forEach(e=>{t(e)})},window.snow.addMeasureOverlay=addMeasureOverlay,snow.tooltipObjects=[],snow.createMeasureTooltip=function(e){snow.measureTooltipElement=document.createElement("div"),snow.measureTooltipElement.className="tooltip tooltip-measure",snow.measureTooltip=new ol.Overlay({element:snow.measureTooltipElement,offset:[0,-15],positioning:"bottom-center"});let o={ol_uid:e.ol_uid,overlay:snow.measureTooltip,element:snow.measureTooltipElement};snow.tooltipObjects.push(o),snow.drawMap.addOverlay(snow.measureTooltip)},snow.removeSingleMeasureTooltip=function(e){snow.tooltipObjects.forEach(o=>{if(e.ol_uid==o.ol_uid){let e=o.element;e.parentNode.removeChild(e),snow.drawMap.removeOverlay(o.overlay);let t=snow.tooltipObjects.indexOf(o);snow.tooltipObjects.splice(t,1)}})},snow.removeAllMeasureTooltip=function(){snow.tooltipObjects.forEach(e=>{let o=e.element;o.parentNode.removeChild(o),snow.drawMap.removeOverlay(e.overlay)}),snow.tooltipObjects=[]}})(),(()=>{var pol=window.pol;window.pol.features=window.pol.features||{};var snow=window.snow||{};pol.features.init=function(e){snow.init(e)},pol.features.Edit=class extends pol.core.Widget{constructor(){super(),this.classname="features.Edit",this.suspendCb=!1;const e=this;this.tool=snow.drawTools,this.icontool=snow.iconTools,this.widget={view:function(){return setTimeout(snow.cssColors,500),m("div",[m("h1","Feature draw tool"),m("label",{class:"non-interactive"},["Feature type: ",m.trust("&nbsp;")]),m("select",{id:"gSelect",onchange:()=>{!function(o){"Point"!=snow.drawType&&"optPoint"==o?m.mount($("#toolbox")[0],e.icontool):m.mount($("#toolbox")[0],e.tool);"optPolygon"==o?snow.drawType="Polygon":"optLine"==o?snow.drawType="LineString":"optCircle"==o?snow.drawType="Circle":"optPoint"==o?snow.drawType="Point":console.log("Unexpected error while selecting geometry type");snow.refreshDraw()}($("#gSelect").val())}},[m("option",{value:"optPolygon"},"Polygon"),m("option",{value:"optLine"},"Line String"),m("option",{value:"optCircle"},"Circle"),m("option",{value:"optPoint"},"Point (icon)")]),m("div#toolbox"),m("div.link_id",{onclick:r},"Feature properties...")])}},snow.deleteHighlightHandler(),snow.drawSource.on("removefeature",e=>{1==e.feature.remove&&(e.feature.remove=NaN,t(e.feature,"rm"))}),snow.drawSource.on("changefeature",e=>{t(e.feature,"chg")}),snow.addDrawCB(e=>{t(e.feature,"add")}),CONFIG.mb.map.on("change:view",()=>{e.restoreFeatures()}),setTimeout(()=>e.restoreFeatures(),1e3),snow.draftLayer.setVisible(!1);let o=null;function t(t,r){t.layer=snow.drawLayer.get("name"),null!=o&&"chg"==r&&clearTimeout(o),o=setTimeout(()=>{e.doUpdate(t,r),o=null},2e3)}function r(){e.props||(e.props=new pol.features.Properties(e)),e.props.isActive()||e.props.activatePopup("features.Properties",[60,60],!0)}}onActivate(){snow.activate(),snow.featureEdit=this,snow.draftLayer.setVisible(!0),setTimeout(()=>m.mount($("#toolbox")[0],this.tool),100)}onclose(){snow.deselectAll(),snow.deactivate(),snow.removeDraw(),snow.removeModify(),snow.draftLayer.setVisible(!1),this.props&&this.props.isActive()&&this.props.close()}restoreFeatures(e){const o=CONFIG.server;if(null!=o&&o.isAuth()&&o.hasDb){const t="feature"+(e?"."+e:"");o.getObj(t,e=>{for(const o of e)if(null!=o){let e=this.obj2feature(o.data);if(e.index=o.id,e.layer&&"DRAFT"!=e.layer){const o=getWIDGET("layers.List"),t=o?o.getLayer(e.layer):null;t?(t.getSource().addFeature(e),e.layer=NaN):snow.drawSource.addFeature(e)}else snow.drawSource.addFeature(e)}})}}reload(){if(this.suspendCb)return;const e=snow.drawSource.getFeatures();for(const o of e)o.index&&snow.drawSource.removeFeature(o);this.restoreFeatures(),this.props&&setTimeout(this.props.update,200)}removeFeatures(e){const o=CONFIG.server;if(null!=o&&o.isAuth()&&o.hasDb){const t="feature"+(e?"."+e:""),r=getWIDGET("layers.List");if(!r)return;const l=r.getLayer(e);if(null==l)return;const n=l.getSource().getFeatures();for(const e of n)e.index&&o.removeObj(t,e.index)}}doUpdate(e,o,t){const r=CONFIG.server;if(null!=r&&r.isAuth()&&r.hasDb){const l="feature"+(t?"."+t:""),n="feature"+(e.layer&&"DRAFT"!=e.layer?"."+e.layer:"");"rm"==o&&r.removeObj(l,e.index),"add"==o&&r.putObj(n,this.feature2obj(e),o=>{e.index=o}),"chg"==o&&r.updateObj(n,e.index,this.feature2obj(e)),this.suspendCb=!0,setTimeout(()=>{this.suspendCb=!1},2e3)}}feature2obj(e){let o=e.getGeometry().clone(),t=e.originalStyle?e.originalStyle:e.getStyle();o.transform(CONFIG.mb.view.getProjection(),"EPSG:4326");let r={layer:e.layer,type:o.getType(),style:this.style2obj(t,o.getType()),label:e.label};return"Circle"==r.type?(r.center=o.getCenter(),r.radius=o.getRadius()):"Polygon"==r.type||"LineString"==r.type||"Point"==r.type?r.coord=o.getCoordinates():console.error("Unknown geom type: "+r.type),r}obj2feature(e){let o=null,t=new ol.Feature;if("Circle"==e.type)o=new ol.geom.Circle(e.center,e.radius);else if("Polygon"==e.type)o=new ol.geom.Polygon(e.coord);else if("LineString"==e.type)o=new ol.geom.LineString(e.coord);else{if("Point"!=e.type)return console.error("Unknown geom type: "+e.type),t;o=new ol.geom.Point(e.coord)}return o.transform("EPSG:4326",CONFIG.mb.view.getProjection()),t.setGeometry(o),t.setStyle(this.obj2style(e.style,e.type)),t.label=e.label,t.layer=e.layer,t}style2obj(e,o){return"Point"==o?{image:e.getImage().getSrc()}:{stroke:{color:e.getStroke().getColor(),width:e.getStroke().getWidth(),lineDash:e.getStroke().getLineDash()},fill:e.getFill()?{color:e.getFill().getColor()}:null}}obj2style(e,o){let t=snow.getStyle();return"Point"==o?t.setImage(snow.getIconStyle(e.image)):(t.setStroke(new ol.style.Stroke(e.stroke)),t.setFill(null==e.fill?null:new ol.style.Fill(e.fill))),t}},pol.widget.setFactory("features.Edit",{create:()=>new pol.features.Edit})})(),pol=window.pol,window.pol.features=window.pol.features||{},pol.features.Properties=class extends pol.core.Widget{constructor(e){super();const o=this;o.classname="features.Properties";const t=()=>snow.drawSource.getFeatures();function r(){WIDGET("layers.List",[50,70],!0,e=>e.selectType("drawing"))}function l(e){return"LineString"==e?"(LStr)":"Circle"==e?"(Circ)":"Polygon"==e?"(Poly)":"Point"==e?"(Point)":e}function n(){const e=$("select#tolayer").val();e&&null!=e?$("span#tolayer").show():$("span#tolayer").hide()}function a(e){CONFIG.mb.gui.removePopup(),CONFIG.mb.goto_Pos(e,!1)}function i(e){return"["+Math.round(1e3*e[0])/1e3+", "+Math.round(1e3*e[1])/1e3+"]"}function c(e){const o=t()[e].getGeometry().clone();o.transform(CONFIG.mb.view.getProjection(),"EPSG:4326"),"Point"==o.getType()?CONFIG.mb.setCenter(o.getCoordinates(),5):(CONFIG.mb.fitExtent(o.getExtent()),CONFIG.mb.view.setZoom(CONFIG.mb.view.getZoom()-1)),s(t()[e])}function s(e){o.selected=e,o.label(o.selected.label),function(e){const t=e.getGeometry().clone(),r=t.clone();t.transform(CONFIG.mb.view.getProjection(),"EPSG:4326"),o.type=t.getType(),o.center=NaN,o.radius=NaN,o.colist=NaN,"Polygon"==o.type||"LineString"==o.type?(o.colist=t.getCoordinates(),1==o.colist.length&&(o.colist=o.colist[0])):"Circle"==o.type&&(o.center=t.getCenter(),o.radius=r.getRadius())}(e),m.redraw()}function d(e){0!=confirm("Remove - are you sure?")&&(o.selected==t()[e]&&(o.selected=null,o.label(""),o.colist=null),snow.deleteFeature(t()[e]))}function g(){null!=o.selected&&(o.selected.label=o.label(),o.drawTool.doUpdate(o.selected,"chg"))}function u(){const e=$("select#tolayer").val();let t=null;for(t of o.layerList.getLayers())if(t.get("name")==e)return t;return null}function p(){const e=u();if(null==o.selected)console.warn("No feature selected");else if(null==e)console.warn("No target layer selected");else if(snow.drawLayer==e)console.warn("Source and target layers is the same");else{e.getSource().addFeature(o.selected),snow.deleteFeature(o.selected),o.selected.layer=e.get("name");const t=o.selected;setTimeout(()=>o.editor.doUpdate(t,"chg"),1200),o.selected=null,o.colist=NaN,o.radius=NaN}}function w(){const e=u();null==e?console.warn("No target layer selected"):snow.drawLayer==e?console.warn("Source and target layers is the same"):e.getSource().forEachFeature(t=>{snow.drawSource.addFeature(t),e.getSource().removeFeature(t),t.layer="DRAFT",setTimeout(()=>o.editor.doUpdate(t,"chg",e.get("name")),1200),console.log("Moved feature '"+t.label+"' from '"+t.layer+"'")})}function k(){m.redraw()}o.selected=null,o.drawTool=e||snow.featureEdit,o.label=m.stream(""),o.layerList=getWIDGET("layers.List"),o.editor=getWIDGET("features.Edit"),o.circle={view:function(){return m("div#circleInfo",[m("span.field",[m("span.sleftlab","Center: "),o.center?m("span.coord",{onclick:pol.ui.apply(a,o.center)},i(o.center)):"-"]),m("span.field",[m("span.sleftlab","Radius: "),m("span",o.radius?o.radius<1e3?Math.round(100*o.radius)/100+" m":Math.round(o.radius/100)/10+" km":"-")])])}},o.coord={view:function(){return o.colist.length<50?m("div#colist",o.colist.map(e=>[m("span.coord",{onclick:pol.ui.apply(a,e)},i(e)),", "])):m("div#colist","(more than 50 points)")}},o.layers={view:function(e){return m("select#"+e.attrs.id,{onchange:()=>o.changeHandler},o.layerList.getLayers().filter(e=>e.get("drawing")).map(e=>m("option",{value:e.get("name")},e.get("name"))))}},o.widget={view:function(){let e=0;return m("div#features",[m("h1","Feature manager"),m("div#fcontainer",[m("table.features",m("caption","Editor features:"),m("tbody",t().map(t=>m("tr",{class:t==o.selected?"selected":""},[m("td",m(pol.ui.removeEdit,{remove:pol.ui.apply(d,e),edit:pol.ui.apply(c,e++)})),m("td",l(t.getGeometry().getType())),m("td",t.label?t.label:"")])))),m("div#movebutt",m("button",{onclick:p,title:"Move feature to layer"},">"),pol.ui.br,m("button",{onclick:w,title:"Get features from layer for editing"},"<")),m("div#layerfeatures",[m("h2","Drawing layer:"),m("span",[m(o.layers,{id:"tolayer"}),m("span.add",{title:"Add/manage layers",onclick:r},"+")]),null!=u()&&u().getSource().getFeatures().length>0?m("table.lfeatures",[m("caption","Layer features:"),m("tbody",u().getSource().getFeatures().map(e=>m("tr",m("td",e.label?e.label:"(no label)"))))]):""])]),hr,m("span.field",[m("span.sleftlab","Type: "),m("span",null==o.selected?"---":o.selected.getGeometry().getType())]),m("span.field",[m("span.sleftlab","Label: "),m(pol.ui.textInput,{id:"editLabel",size:19,maxLength:25,value:o.label,regex:/.*$/i}),m("button",{onclick:g,title:"Update properties"},"Update")]),o.radius?m(o.circle):o.colist?m(o.coord):""])},onupdate:n},m.redraw(),setTimeout(k,3300),snow.drawSource.on("changefeature",k),$(document).on("selectfeature",()=>{s(snow.lastSelected),k()}),snow.addDrawCB(e=>setTimeout(()=>k(),100)),CONFIG.mb.map.on("change:view",()=>setTimeout(()=>k(),100)),setTimeout(n,500)}update(){m.redraw()}}})();